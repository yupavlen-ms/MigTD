// This devcontainer is intended for developer use only, via the dev containers
// extension or Github codespaces. It is not used for CI or anything else.
{
    // Should be Ubuntu 22.04 LTS or RedHat 8.5 or CentOS Stream 8 (all 64-bit).
    "name": "Ubuntu",
    "image": "mcr.microsoft.com/devcontainers/base:jammy",

    // Add the Rust feature and install all supported targets, since this is
    // meant for local developer use.
    "features": {
        "ghcr.io/devcontainers/features/rust:1": {
            "version": "1.83",
            "profile": "default",
            "targets": "x86_64-unknown-none"
        },

        // Add the SSHD feature so that users can SSH into the container.
        "ghcr.io/devcontainers/features/sshd:1": {}
    },

    // Add rust-analyzer by default.
    "customizations": {
        "vscode": {
            "extensions": [
                "rust-lang.rust-analyzer"
            ]
        }
    },

    // Allow /dev/kvm access by setting privileged to true.
    "privileged": true,

    // Before build.
    "updateContentCommand": "./sh_script/preparation.sh",

    // Set the minimum host cpus to 8, since otherwise builds or rust-analyzer
    // will not work well.
    "hostRequirements": { "cpus": 8 }
}
